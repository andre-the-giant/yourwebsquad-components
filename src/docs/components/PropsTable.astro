---
import { validateProps } from "../../lib/utils/props.js";
import Accordion from "@lib/components/Accordion/Accordion.astro";

const schema = {
  title: { type: "string" },
  props: { type: "array" },
  accordionId: { type: "string" },
  accordionGroup: { type: "string" },
  accordionOpen: { type: "boolean" }
};

const {
  title = "Props",
  props = [],
  accordionId,
  accordionGroup,
  accordionOpen = false
} = validateProps(schema, Astro.props, { component: "PropsTable" });

const propstableId = accordionId
  ? `propstable-${accordionId}`
  : `propstable-${Math.random().toString(36).slice(2, 9)}`;
---

<Accordion
  defaultOpen="props-preview"
  class="props"
  style="--accordion-trigger-font:var(--font-display)"
>
  <div
    class="props-table__title title"
    data-accordion={propstableId}
    data-accordion-group={accordionGroup}
  >
    {title}
  </div>
  <div
    class="props-table__wrap"
    data-accordion-target={propstableId}
    data-accordion-group={accordionGroup}
  >
    <table class="props__table">
      <thead>
        <tr>
          <th>prop</th>
          <th>type</th>
          <th>default</th>
          <th>description</th>
        </tr>
      </thead>
      <tbody>
        {
          props.map((prop) => (
            <tr class={`${prop.deprecated ? "deprecated" : ""}`}>
              <td class="prop-name">
                <code>{prop.name}</code>
              </td>
              <td class="prop-type">{prop.type}</td>
              <td class="prop-default">{prop.default ?? "â€”"}</td>
              <td class="prop-description">{!prop.deprecated ? prop.description : "DEPRECATED"}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </div>
</Accordion>

<style>
  .props {
    display: grid;
    gap: var(--space-2);
  }

  .props-table__title {
    font-size: var(--size-lg);
    margin: 0;
  }
  .deprecated {
    .prop-name code,
    .prop-type,
    .prop-default {
      text-decoration: line-through;
    }
    .prop-description {
      color: red;
    }
  }
  .props__hint {
    font-size: var(--size-xs);
    color: var(--color-muted);
    margin: 0;
  }

  .props-table__wrap {
    border: 1px solid var(--color-border);
    background: var(--color-surface);
    overflow: hidden;
  }

  .props__table {
    width: 100%;
    border-collapse: collapse;
    font-family: var(--font-mono);
    font-size: var(--size-xs);
    table-layout: fixed;
  }

  th,
  td {
    padding: 0.35rem 0.5rem;
    border-bottom: 1px solid var(--color-border);
    vertical-align: top;
  }

  th {
    text-align: left;
    color: var(--color-muted);
    font-weight: var(--weight-medium);
  }

  tbody tr:nth-child(odd) {
    background: color-mix(in srgb, var(--color-accent-muted) 30%, var(--color-surface) 70%);
  }

  code {
    font-family: var(--font-mono);
    font-size: var(--size-xs);
  }
</style>
