---
import DocLayout from "@docs/layouts/DocLayout.astro";
import Preview from "@docs/components/Preview.astro";
import PropsTable from "@docs/components/PropsTable.astro";
import { components } from "@docs/data/components.js";
import PhotoRoll from "@lib/components/PhotoRoll/PhotoRoll.astro";
import Image from "@lib/components/Image/Image.astro";
import Hero from "@lib/components/Hero/Hero.astro";

const propsTable = [
  { name: "id", type: "string", description: "Optional id for the root element." },
  { name: "class", type: "string", description: "Additional class names." },
  { name: "style", type: "string", description: "Inline styles for the root element." },
  {
    name: "orientation",
    type: `"horizontal" | "vertical"`,
    default: '"horizontal"',
    description: "Scroll direction."
  },
  {
    name: "images",
    type: "Array<{ url: string; description?: string }>",
    description:
      "Provide images directly; when set, slots are ignored and the array renders images."
  },
  {
    name: "imageSizes",
    type: "string",
    description:
      "Optional sizes attribute forwarded to the internal Image when using the images prop."
  },
  {
    name: "imageWidths",
    type: "number[]",
    description: "Optional widths array forwarded to the internal Image when using the images prop."
  },
  {
    name: "showNextButton",
    type: "boolean",
    default: "false",
    description: "Displays the right-side next control."
  },
  {
    name: "nextIcon",
    type: "string",
    default: '"arrow-right"',
    description: "Icon name for the next control."
  },
  {
    name: "nextIconSize",
    type: "string",
    description: "Icon size passed to the Icon component (sm | md | lg | CSS length)."
  },
  {
    name: "showBullets",
    type: "boolean",
    default: "false",
    description: "Displays bullet pagination at the bottom."
  },
  {
    name: "autoplay",
    type: "boolean",
    default: "false",
    description: "Automatically advances slides; shows play/pause control."
  },
  {
    name: "autoplayInterval",
    type: "number",
    default: "5",
    description: "Interval in seconds between autoplay moves (must be greater than 0)."
  }
];

const styleVars = [
  { name: "--photoroll-height", default: "50vh", description: "Overall component height." },
  { name: "--photoroll-dim", default: "0.7", description: "Brightness for inactive slides." },
  {
    name: "--photoroll-bright",
    default: "1",
    description: "Brightness for the first/active slide."
  },
  {
    name: "--photoroll-glow",
    default: "drop-shadow(0 0 0.35rem rgba(0, 0, 0, 0.35))",
    description: "Filter applied to images."
  },
  { name: "--photoroll-control-size", default: "44px", description: "Control hit target size." },
  {
    name: "--photoroll-control-bg",
    default: "rgba(0, 0, 0, 0.65)",
    description: "Control background."
  },
  { name: "--photoroll-control-color", default: "white", description: "Control icon color." },
  {
    name: "--photoroll-control-shadow",
    default: "0 4px 12px rgba(0, 0, 0, 0.35)",
    description: "Control shadow."
  },
  {
    name: "--photoroll-control-offset",
    default: "1rem",
    description: "Inset from the edges for controls."
  },
  { name: "--photoroll-control-z", default: "2", description: "Stacking context for controls." },
  { name: "--photoroll-bullet-size", default: "10px", description: "Bullet diameter." },
  { name: "--photoroll-bullet-gap", default: "0.5rem", description: "Spacing between bullets." },
  {
    name: "--photoroll-bullet-color",
    default: "rgba(255, 255, 255, 0.55)",
    description: "Bullet color."
  },
  {
    name: "--photoroll-bullet-active-color",
    default: "white",
    description: "Active bullet color."
  },
  {
    name: "--photoroll-bullets-offset",
    default: "1rem",
    description: "Bottom inset for the bullet row."
  },
  {
    name: "--photoroll-next-rotation",
    default: "0deg (horizontal) / 90deg (vertical)",
    description: "Rotation applied to the next icon based on orientation."
  },
  {
    name: "--photoroll-zoom",
    default: "1",
    description: "Base scale applied to images for a subtle zoom-in effect."
  },
  {
    name: "--photoroll-zoom-active",
    default: "1.07",
    description: "Scale applied to the active image for the zoom effect."
  },
  {
    name: "--photoroll-zoom-duration",
    default: "10s",
    description: "Duration of the active image zoom animation."
  }
];

const defaultCode = "<PhotoRoll />";
const customCode = '<PhotoRoll id="photo-roll-sample" />';

const fallbackPhotos = [
  {
    url: "https://images.unsplash.com/photo-1472214103451-9374bd1c798e?auto=format&fit=crop&w=1600&q=70",
    description: "Snowy mountain range at sunrise",
    title: "Mountain sunrise"
  },
  {
    url: "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1600&q=70",
    description: "Waterfall flowing through a forest",
    title: "Forest waterfall"
  },
  {
    url: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1600&q=70",
    description: "Blue lake with mountain reflections",
    title: "Mirror lake"
  },
  {
    url: "https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1600&q=70",
    description: "Cabin in snowy woods at dusk",
    title: "Winter cabin"
  },
  {
    url: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=1600&q=70",
    description: "Green valley under dramatic clouds",
    title: "Green valley"
  },
  {
    url: "https://images.unsplash.com/photo-1439853949127-fa647821eba0?auto=format&fit=crop&w=1600&q=70",
    description: "Coastal cliffs with ocean waves",
    title: "Coastal cliffs"
  }
];

function normalizePhotos(raw = []) {
  return raw
    .filter((photo) => photo && typeof photo.url === "string" && photo.url.trim() !== "")
    .map((photo, idx) => ({
      url: photo.url,
      description: photo.description || `Photo ${idx + 1}`,
      title: photo.title || `Slide ${idx + 1}`
    }));
}

async function loadPhotos() {
  try {
    const res = await fetch("https://boringapi.com/api/v1/photos");
    if (!res.ok) throw new Error(`Photo API returned ${res.status}`);

    const payload = await res.json();
    if (!payload || !Array.isArray(payload.photos)) {
      throw new Error("Photo API payload is invalid");
    }

    const normalized = normalizePhotos(payload.photos);
    if (!normalized.length) throw new Error("Photo API returned no valid photos");
    return normalized;
  } catch (err) {
    console.warn("[PhotoRoll docs] Falling back to local demo photos:", err?.message || err);
    return normalizePhotos(fallbackPhotos);
  }
}

const photos = await loadPhotos();
const data = { photos };
const imagesArray = photos.map(({ url, description }) => ({ url, description }));
---

<DocLayout
  title="PhotoRoll"
  description="A component to display images and scroll through them"
  items={components}
>
  <PropsTable props={propsTable} />
  <PropsTable title="Style variables" props={styleVars} />

  <div class="preview-grid">
    <Preview
      title="Using the images props array"
      code={`
********************************************************************
ALL DEMOS ON THIS PAGE GET DATA FROM
const photoroll = await fetch("https://boringapi.com/api/v1/photos");
const data = await photoroll.json();
Use images props array is better. Prefer it to use slots
********************************************************************

// const imagesArray=data.photos.map(({ url, description }) => ({ url, description }))

<PhotoRoll
      images={imagesArray}
        showBullets={true}
/>
`}
    >
      <PhotoRoll images={imagesArray} showBullets={true} />
    </Preview>

    <Preview
      title="Default"
      code={`
***********************************************
ADD CLASS in-photo-roll to all <Image> in slot. 
***********************************************
<PhotoRoll>
  {data.photos.map((photo,idx) => (
    <Image src={photo.url} alt={photo.description} class="in-photo-roll" /> 
  ))}
</PhotoRoll>
`}
    >
      <PhotoRoll>
        {
          data.photos.map((photo, idx) => (
            <Image src={photo.url} alt={photo.description} class="in-photo-roll" />
          ))
        }
      </PhotoRoll>
    </Preview>

    <Preview
      title="Orientation vertical and buttons"
      code={`
<PhotoRoll
  orientation="vertical"
>
  {data.photos.map((photo,idx) => (
    <Image src={photo.url} alt={photo.description} class="in-photo-roll" /> 
  ))}
</PhotoRoll>
`}
    >
      <PhotoRoll orientation="vertical" showNextButton={true} showBullets={true}>
        {
          data.photos.map((photo, idx) => (
            <Image src={photo.url} alt={photo.description} class="in-photo-roll" />
          ))
        }
      </PhotoRoll>
    </Preview>

    <Preview
      title="Autoplay"
      code={`
<PhotoRoll
    orientation="vertical"
    autoplay={true}
    autoplayInterval={5}
    images={imagesArray}
>
  {data.photos.map((photo,idx) => (
    <Image src={photo.url} alt={photo.description} class="in-photo-roll" /> 
  ))}
</PhotoRoll>
`}
    >
      <PhotoRoll orientation="vertical" autoplay={true} autoplayInterval={5} images={imagesArray} />
    </Preview>

    <Preview
      title="Autoplay with slot"
      code={`
<PhotoRoll
    autoplay={true}
    autoplayInterval={3}
>
  {data.photos.map((photo,idx) => (
    <Image src={photo.url} alt={photo.description} class="in-photo-roll" /> 
  ))}
</PhotoRoll>
`}
    >
      <PhotoRoll autoplay={true} autoplayInterval={3}>
        {
          data.photos.map((photo, idx) => (
            <Image src={photo.url} alt={photo.description} class="in-photo-roll" />
          ))
        }
      </PhotoRoll>
    </Preview>

    <Preview
      title="It works with Other components too ! "
      code={`
************************
Add class in-photo-roll 
************************

<PhotoRoll
        style="--photoroll-zoom-active:1;"
      >
  {data.photos.slice(-2).map((photo,idx) => (
    <Hero
      title={photo.title}
      body={photo.description}
      img={photo.url}
      class="in-photo-roll"
      />
  ))}
</PhotoRoll>`}
    >
      <PhotoRoll style="--photoroll-zoom-active:1;">
        {
          data.photos
            .slice(-2)
            .map((photo, idx) => (
              <Hero
                title={photo.title}
                body={photo.description}
                img={photo.url}
                class="in-photo-roll"
              />
            ))
        }
      </PhotoRoll>
    </Preview>
  </div>
</DocLayout>
