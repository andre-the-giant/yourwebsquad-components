---
import DocLayout from "@docs/layouts/DocLayout.astro";
import Preview from "@docs/components/Preview.astro";
import PropsTable from "@docs/components/PropsTable.astro";
import { components } from "@docs/data/components.js";
import Form from "@lib/components/Form/Form.astro";
import FormInput from "@lib/components/Form-Input/index.astro";
import FormSelect from "@lib/components/Form-Select/index.astro";
import FormTextarea from "@lib/components/Form-Textarea/index.astro";
import FormUpload from "@lib/components/Form-Upload/index.astro";

const basicCode = `<Form formId="contact" locale="en" />`;

const integrationSnippet = `import { defineConfig } from "astro/config";
import yourwebsquadForms from "yourwebsquad-components/forms-integration";

export default defineConfig({
  outDir: "build",
  integrations: [yourwebsquadForms()]
});`;

const stylingSnippet = `<Form
  formId="contact"
  style="
    --form-input-border: 1px solid #0d6ea8;
    --form-input-padding: 0.85rem 1rem;
    --button-solid-bg: #0ea5e9;
    --button-solid-border: #0ea5e9;
    --button-ghost-fg: #0ea5e9;
  "
  submitStyle="--button-solid-shadow: 0 10px 20px color-mix(in srgb, #0ea5e9 35%, transparent);"
  resetStyle="--button-outline-fg: #0ea5e9; --button-outline-border: #0ea5e9;"
/>`;

const contentSnippet = `// src/content/config.ts
import { defineCollection, z } from "astro:content";

const option = z.object({
  value: z.string(),
  label: z.union([z.string(), z.record(z.string(), z.string())])
});

const forms = defineCollection({
  type: "data",
  schema: z.object({
    id: z.string().regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/),
    title: z.union([z.string(), z.record(z.string(), z.string())]),
    endpoint: z.string().optional(),
    fields: z.array(
      z.object({
        name: z.string(),
        label: z.union([z.string(), z.record(z.string(), z.string())]),
        type: z.enum(["text","email","textarea","tel","number","checkbox","radio","select","date","hidden","upload"]),
        required: z.boolean().default(false),
        accept: z.string().optional(),
        imagesOnly: z.boolean().optional(),
        multiple: z.boolean().optional(),
        maxFiles: z.number().int().positive().optional(),
        maxFileSizeMb: z.number().positive().optional(),
        noFileText: z.union([z.string(), z.record(z.string(), z.string())]).optional(),
        browseLabel: z.union([z.string(), z.record(z.string(), z.string())]).optional(),
        removeLabel: z.union([z.string(), z.record(z.string(), z.string())]).optional(),
        options: z.array(option).optional()
      })
    ),
    email: z.object({
      to: z.union([z.string().email(), z.array(z.string().email())]),
      subject: z.union([z.string(), z.record(z.string(), z.string())]),
      intro: z.union([z.string(), z.record(z.string(), z.string())]).optional()
    })
  })
});

export const collections = { forms };`;

const sampleForm = `{
  "id": "contact",
  "title": { "en": "Contact us" },
  "endpoint": "/api/contact/",
  "fields": [
    { "name": "name", "label": { "en": "Name" }, "type": "text", "required": true },
    { "name": "email", "label": { "en": "Email" }, "type": "email", "required": true },
    { "name": "service", "label": { "en": "Service" }, "type": "select", "required": true,
      "options": [
        { "value": "website", "label": { "en": "Website" } },
        { "value": "seo", "label": { "en": "SEO" } }
      ]
    },
    { "name": "reference_images", "label": { "en": "Reference images", "fr": "Images de référence" }, "type": "upload", "required": false, "accept": "image/*", "imagesOnly": true, "multiple": true, "maxFiles": 3, "maxFileSizeMb": 5, "noFileText": { "en": "No image selected", "fr": "Aucune image sélectionnée" }, "browseLabel": { "en": "Choose images", "fr": "Choisir des images" }, "removeLabel": { "en": "Remove", "fr": "Retirer" } },
    { "name": "message", "label": { "en": "Message" }, "type": "textarea", "required": true },
    { "name": "middle_name", "label": { "en": "Leave blank" }, "type": "hidden" }
  ],
  "email": {
    "to": ["hello@example.com"],
    "subject": { "en": "New inquiry from \${name}" },
    "intro": { "en": "Contact form submission" },
    "replyToField": "email"
  },
  "security": {
    "honeypot": { "name": "middle_name", "enabled": true },
    "rateLimit": { "max": 5, "windowSeconds": 60 }
  }
}`;

const props = [
  {
    name: "formId",
    type: "string",
    description: "Id of the form entry from the `forms` content collection."
  },
  {
    name: "form",
    type: "object",
    description: "Pre-resolved form object (bypasses content collection lookup)."
  },
  {
    name: "locale",
    type: "string",
    description: "Locale key to resolve localized labels/placeholders."
  },
  { name: "id", type: "string", description: "Optional HTML id (auto-generated if omitted)." },
  {
    name: "action",
    type: "string",
    description: "Override form endpoint (defaults to form.endpoint)."
  },
  { name: "target", type: "string", description: "Form target (e.g., _blank)." },
  {
    name: "enctype",
    type: "string",
    description: "Encoding type. Auto-defaults to multipart/form-data when upload fields exist."
  },
  {
    name: "novalidate",
    type: "boolean",
    default: "false",
    description: "Bypass native validation."
  },
  {
    name: "preventEnterSubmit",
    type: "boolean",
    default: "true",
    description: "Blocks Enter submits except on buttons/selects/textareas."
  },
  { name: "submitLabel", type: "string", default: '"Send"', description: "Submit button label." },
  {
    name: "submitVariant",
    type: `"solid" | "outline" | "ghost"`,
    default: '"solid"',
    description: "Submit button style."
  },
  {
    name: "submitSize",
    type: `"sm" | "md" | "lg"`,
    default: '"md"',
    description: "Submit button size."
  },
  {
    name: "submitDisabled",
    type: "boolean",
    default: "false",
    description: "Disable submit button."
  },
  {
    name: "submitClass",
    type: "string",
    description: "Additional class for the default submit button."
  },
  {
    name: "submitStyle",
    type: "string",
    description: "Inline style for the default submit button (CSS vars supported)."
  },
  { name: "showReset", type: "boolean", default: "true", description: "Render reset button." },
  { name: "resetLabel", type: "string", default: '"Reset"', description: "Reset button label." },
  {
    name: "resetVariant",
    type: `"solid" | "outline" | "ghost"`,
    default: '"outline"',
    description: "Reset button style."
  },
  {
    name: "resetSize",
    type: `"sm" | "md" | "lg"`,
    default: '"md"',
    description: "Reset button size."
  },
  {
    name: "resetDisabled",
    type: "boolean",
    default: "false",
    description: "Disable reset button."
  },
  {
    name: "resetClass",
    type: "string",
    description: "Additional class for the default reset button."
  },
  {
    name: "resetStyle",
    type: "string",
    description: "Inline style for the default reset button (CSS vars supported)."
  },
  { name: "class", type: "string", description: "Additional className for form." },
  {
    name: "style",
    type: "string",
    description: "Inline styles (CSS variables cascade to inputs/buttons)."
  }
];
---

<DocLayout
  title="Form"
  description="Schema-driven form wrapper that renders fields from the forms content collection, supports file uploads, prevents Enter submits by default, and includes Send and Reset buttons."
  items={components}
>
  <PropsTable props={props} />

  <Preview title="Basic form" code={basicCode}>
    <div class="column">
      <Form formId="contact" />
    </div>
  </Preview>

  <Preview title="Setup: Astro config" code={integrationSnippet} lang="js">
    <div class="column">
      <p>Add the forms integration to generate PHP endpoints during <code>astro build</code>.</p>
    </div>
  </Preview>

  <Preview title="Setup: Content collection" code={contentSnippet} lang="ts">
    <div class="column">
      <p>Define the <code>forms</code> collection (JSON data) in your project.</p>
    </div>
  </Preview>

  <Preview title="Sample form entry" code={sampleForm} lang="json">
    <div class="column">
      <p>
        Place JSON files in <code>src/content/forms/</code>. Build will emit <code
          >/build/api/&lt;id&gt;/index.php</code
        >.
      </p>
    </div>
  </Preview>

  <Preview title="Styling with CSS variables" code={stylingSnippet}>
    <div class="column">
      <p>
        Set CSS variables on <code>&lt;Form&gt;</code> (or a parent class) to cascade into inputs and
        the built-in buttons. Use <code>submitStyle</code>/<code>resetStyle</code> when you want to target
        only the default actions without affecting other buttons inside the form.
      </p>
    </div>
  </Preview>

  <Preview title="Styled live example" code={stylingSnippet}>
    <div class="column">
      <Form
        style="--form-input-border: 1px solid #0d6ea8; --form-input-padding: 0.85rem 1rem; --button-solid-bg: #0ea5e9; --button-solid-border: #0ea5e9; --button-ghost-fg: #0ea5e9;"
        submitStyle="--button-solid-shadow: 0 10px 20px color-mix(in srgb, #0ea5e9 35%, transparent);"
        resetStyle="--button-outline-fg: #0ea5e9; --button-outline-border: #0ea5e9;"
      >
        <FormInput label="Name" placeholder="Ada Lovelace" required />
        <FormSelect
          label="Project type"
          required
          options={[
            { label: "Website", value: "website" },
            { label: "SEO", value: "seo" },
            { label: "Brand", value: "brand" }
          ]}
          placeholder="Choose one"
        />
        <FormTextarea label="Message" placeholder="Tell us about your project" required />
        <FormUpload
          label="Reference images"
          name="images"
          accept="image/*"
          multiple
          maxFiles={3}
          maxFileSizeMb={5}
        />
      </Form>
    </div>
  </Preview>

  <style>
    .column {
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
      width: min(640px, 100%);
    }
  </style>
</DocLayout>
