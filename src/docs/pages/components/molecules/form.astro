---
import DocLayout from "@docs/layouts/DocLayout.astro";
import Preview from "@docs/components/Preview.astro";
import PropsTable from "@docs/components/PropsTable.astro";
import { components } from "@docs/data/components.js";
import Form from "@lib/components/Form/Form.astro";

const basicCode = `<Form formId="contact" locale="en" />`;

const integrationSnippet = `import { defineConfig } from "astro/config";
import yourwebsquadForms from "yourwebsquad-components/forms-integration";

export default defineConfig({
  outDir: "build",
  integrations: [yourwebsquadForms()]
});`;

const contentSnippet = `// src/content/config.ts
import { defineCollection, z } from "astro:content";

const option = z.object({
  value: z.string(),
  label: z.union([z.string(), z.record(z.string(), z.string())])
});

const forms = defineCollection({
  type: "data",
  schema: z.object({
    id: z.string().regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/),
    title: z.union([z.string(), z.record(z.string(), z.string())]),
    endpoint: z.string().optional(),
    fields: z.array(
      z.object({
        name: z.string(),
        label: z.union([z.string(), z.record(z.string(), z.string())]),
        type: z.enum(["text","email","textarea","tel","number","checkbox","radio","select","date","hidden"]),
        required: z.boolean().default(false),
        options: z.array(option).optional()
      })
    ),
    email: z.object({
      to: z.union([z.string().email(), z.array(z.string().email())]),
      subject: z.union([z.string(), z.record(z.string(), z.string())]),
      intro: z.union([z.string(), z.record(z.string(), z.string())]).optional()
    })
  })
});

export const collections = { forms };`;

const sampleForm = `{
  "id": "contact",
  "title": { "en": "Contact us" },
  "endpoint": "/api/contact/",
  "fields": [
    { "name": "name", "label": { "en": "Name" }, "type": "text", "required": true },
    { "name": "email", "label": { "en": "Email" }, "type": "email", "required": true },
    { "name": "service", "label": { "en": "Service" }, "type": "select", "required": true,
      "options": [
        { "value": "website", "label": { "en": "Website" } },
        { "value": "seo", "label": { "en": "SEO" } }
      ]
    },
    { "name": "message", "label": { "en": "Message" }, "type": "textarea", "required": true },
    { "name": "middle_name", "label": { "en": "Leave blank" }, "type": "hidden" }
  ],
  "email": {
    "to": ["hello@example.com"],
    "subject": { "en": "New inquiry from \${name}" },
    "intro": { "en": "Contact form submission" },
    "replyToField": "email"
  },
  "security": {
    "honeypot": { "name": "middle_name", "enabled": true },
    "rateLimit": { "max": 5, "windowSeconds": 60 }
  }
}`;

const props = [
  { name: "formId", type: "string", description: "Id of the form entry from the `forms` content collection." },
  { name: "form", type: "object", description: "Pre-resolved form object (bypasses content collection lookup)." },
  { name: "locale", type: "string", description: "Locale key to resolve localized labels/placeholders." },
  { name: "id", type: "string", description: "Optional HTML id (auto-generated if omitted)." },
  { name: "action", type: "string", description: "Override form endpoint (defaults to form.endpoint)." },
  { name: "target", type: "string", description: "Form target (e.g., _blank)." },
  { name: "enctype", type: "string", description: "Encoding type." },
  {
    name: "novalidate",
    type: "boolean",
    default: "false",
    description: "Bypass native validation."
  },
  {
    name: "preventEnterSubmit",
    type: "boolean",
    default: "true",
    description: "Blocks Enter submits except on buttons/selects/textareas."
  },
  { name: "submitLabel", type: "string", default: '"Send"', description: "Submit button label." },
  {
    name: "submitVariant",
    type: `"solid" | "outline" | "ghost"`,
    default: '"solid"',
    description: "Submit button style."
  },
  {
    name: "submitSize",
    type: `"sm" | "md" | "lg"`,
    default: '"md"',
    description: "Submit button size."
  },
  {
    name: "submitDisabled",
    type: "boolean",
    default: "false",
    description: "Disable submit button."
  },
  { name: "showReset", type: "boolean", default: "true", description: "Render reset button." },
  { name: "resetLabel", type: "string", default: '"Reset"', description: "Reset button label." },
  {
    name: "resetVariant",
    type: `"solid" | "outline" | "ghost"`,
    default: '"outline"',
    description: "Reset button style."
  },
  {
    name: "resetSize",
    type: `"sm" | "md" | "lg"`,
    default: '"md"',
    description: "Reset button size."
  },
  {
    name: "resetDisabled",
    type: "boolean",
    default: "false",
    description: "Disable reset button."
  },
  { name: "class", type: "string", description: "Additional className for form." }
];
---

<DocLayout
  title="Form"
  description="Schema-driven form wrapper that renders fields from the forms content collection, prevents Enter submits by default, and includes Send and Reset buttons."
  items={components}
>
  <PropsTable props={props} />

  <Preview title="Basic form" code={basicCode}>
    <div class="column">
      <Form formId="contact" />
    </div>
  </Preview>

  <Preview title="Setup: Astro config" code={integrationSnippet} lang="js">
    <div class="column">
      <p>Add the forms integration to generate PHP endpoints during <code>astro build</code>.</p>
    </div>
  </Preview>

  <Preview title="Setup: Content collection" code={contentSnippet} lang="ts">
    <div class="column">
      <p>Define the <code>forms</code> collection (JSON data) in your project.</p>
    </div>
  </Preview>

  <Preview title="Sample form entry" code={sampleForm} lang="json">
    <div class="column">
      <p>Place JSON files in <code>src/content/forms/</code>. Build will emit <code>/build/api/&lt;id&gt;/index.php</code>.</p>
    </div>
  </Preview>

  <style>
    .column {
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
      width: min(640px, 100%);
    }
  </style>
</DocLayout>
