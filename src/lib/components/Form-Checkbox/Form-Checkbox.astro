---
/*
Props:
- id?: string
- name?: string
- label?: string
- checked?: boolean
- disabled?: boolean
- required?: boolean
- position?: "left" | "right"  // where the toggle sits relative to label
- ariaLabel?: string
- ariaDescribedBy?: string
- ariaInvalid?: boolean
- helpId?: string
- errorId?: string
- ariaControls?: string
- class?: string
- style?: string
Notes:
- Uses "checkbox hack" styling but keeps native input for accessibility.
- Styling (colors, radius) is controlled via CSS vars (--toggle-*).
- Label text flexes to take remaining row space; toggle can be left or right.
*/
import { validateProps } from "../../utils/props.js";
import { makeStyleVars, mergeClasses } from "../../utils/style.js";
import FormLabel from "../Form-Label/Form-Label.astro";

const schema = {
  id: { type: "string" },
  class: { type: "string" },
  style: { type: "string" },
  name: { type: "string" },
  label: { type: "string" },
  checked: { type: "boolean" },
  disabled: { type: "boolean" },
  required: { type: "boolean" },
  position: { type: "string" },
  ariaLabel: { type: "string" },
  ariaDescribedBy: { type: "string" },
  ariaInvalid: { type: "boolean" },
  helpId: { type: "string" },
  errorId: { type: "string" },
  ariaControls: { type: "string" }
};

const {
  id,
  class: className,
  style,
  name,
  label,
  checked = false,
  disabled = false,
  required = false,
  position = "right",
  checkedColor: _checkedColor,
  uncheckedColor: _uncheckedColor,
  thumbColor: _thumbColor,
  radius: _radius,
  ariaLabel,
  ariaDescribedBy,
  ariaInvalid = false,
  helpId,
  errorId,
  ariaControls,
  ...rest
} = validateProps(schema, Astro.props, { component: "Form-Checkbox" });

const resolvedLabel = label;
const resolvedId = id ?? `form-checkbox-${Math.random().toString(36).slice(2, 9)}`;
const describedIds = [ariaDescribedBy, helpId, errorId].filter(Boolean).join(" ");

const styleVars = {
  "--toggle-checked": "currentColor",
  "--toggle-unchecked": "transparent",
  "--toggle-thumb": "var(--color-surface)",
  "--toggle-radius": "999px"
};
const resolvedStyle = makeStyleVars(styleVars, style);
const resolvedClass = mergeClasses("form-field", className);
const rowClass = mergeClasses("toggle-row", position === "left" ? "pos-left" : "pos-right");
---

<div class={resolvedClass} style={resolvedStyle || undefined}>
  <label class={rowClass} for={resolvedId}>
    {
      position === "left" ? (
        <>
          <input
            id={resolvedId}
            class="toggle-input"
            type="checkbox"
            name={name}
            checked={checked}
            disabled={disabled}
            required={required}
            aria-label={ariaLabel}
            aria-describedby={describedIds || undefined}
            aria-invalid={ariaInvalid ? "true" : undefined}
            aria-controls={ariaControls || undefined}
            {...rest}
          />
          <span class="toggle" aria-hidden="true" />
          <span class="label-text">
            <FormLabel tag="span" label={resolvedLabel} required={required} />
          </span>
        </>
      ) : (
        <>
          <span class="label-text">
            <FormLabel tag="span" label={resolvedLabel} required={required} />
          </span>
          <input
            id={resolvedId}
            class="toggle-input"
            type="checkbox"
            name={name}
            checked={checked}
            disabled={disabled}
            required={required}
            aria-label={ariaLabel}
            aria-describedby={describedIds || undefined}
            aria-invalid={ariaInvalid ? "true" : undefined}
            aria-controls={ariaControls || undefined}
            {...rest}
          />
          <span class="toggle" aria-hidden="true" />
        </>
      )
    }
  </label>
</div>

<style>
  .form-field {
    width: var(--form-width);
  }
  .toggle-row {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    cursor: pointer;
    user-select: none;
    position: relative;
  }

  .toggle-row.pos-left {
    flex-direction: row;
  }
  .toggle-row.pos-right {
    flex-direction: row;
  }

  .label-text {
    flex: 1 1 auto;
    color: var(--color-fg);
  }

  /* Hide native checkbox but keep it accessible */
  .toggle-input {
    position: absolute !important;
    opacity: 0;
    width: 0;
    height: 0;
    margin: 0;
    padding: 0;
  }

  /* visual toggle */
  .toggle {
    --track-w: 44px;
    --track-h: 24px;
    display: inline-block;
    width: var(--track-w);
    height: var(--track-h);
    background: var(--toggle-unchecked);
    border-radius: var(--toggle-radius);
    position: relative;
    transition:
      background 180ms ease,
      box-shadow 180ms ease;
    box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.04) inset;
    flex: 0 0 auto;
  }

  .toggle::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 4px;
    transform: translateY(-50%);
    width: calc(var(--track-h) - 8px);
    height: calc(var(--track-h) - 8px);
    background: var(--toggle-thumb);
    border-radius: calc(var(--toggle-radius));
    transition:
      transform 200ms cubic-bezier(0.2, 0.9, 0.2, 1),
      background 180ms ease;
    box-shadow: 0 2px 6px rgba(16, 24, 40, 0.12);
  }

  /* Checked state */
  .toggle-input:checked + .toggle {
    background: var(--toggle-checked);
  }
  .toggle-input:checked + .toggle::after {
    transform: translateY(-50%) translateX(calc(var(--track-w) - var(--track-h)));
  }

  /* Focus styles */
  .toggle-input:focus + .toggle {
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--toggle-checked) 20%, transparent);
  }

  /* Disabled */
  .toggle-input:disabled + .toggle {
    opacity: 0.6;
    cursor: not-allowed;
  }
</style>
