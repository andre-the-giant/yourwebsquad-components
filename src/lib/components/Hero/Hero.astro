---
/*
Props:
- title?: string
- body?: string — HTML allowed
- cta?: { href?: string, label?: string }
- img?: string — src passed to <Image>
- clip?: string — SVG path for clipPath
- id?: string
- class?: string
- style?: string
*/
import { validateProps } from "../../utils/props.js";
import { makeStyleVars, mergeClasses } from "../../utils/style.js";
import Image from "../Image/Image.astro";
import Link from "../Link/Link.astro";

const schema = {
  id: { type: "string" },
  class: { type: "string" },
  style: { type: "string" },
  title: { type: "string" },
  body: { type: "string" },
  cta: { type: "object" },
  img: { type: "string" },
  clip: { type: "string" }
};

const {
  id,
  class: className,
  style,
  title,
  body,
  cta,
  img,
  clip,
  ...rest
} = validateProps(schema, Astro.props, { component: "Hero" });

const resolvedId = id ?? "hero-" + Math.random().toString(36).slice(2, 9);
const resolvedTitle = title ?? null;
const resolvedBody = body ?? null;
const resolvedClip = clip ?? null;
const resolvedCtaHref = cta?.href ?? null;
const resolvedCtaLabel = cta?.label ?? null;
const isCta = Boolean(resolvedCtaHref && resolvedCtaLabel);
const resolvedImage = img ?? null;

const styleVars = {
  "--hero-gradient-start": "rgba(var(--color-bg-rgb), 30%)",
  "--hero-gradient-end": "rgba(var(--color-bg-rgb), 80%)"
};

const resolvedStyle = makeStyleVars(styleVars, style);
const resolvedClass = mergeClasses("hero", className);
---

<div id={resolvedId} class={resolvedClass} style={resolvedStyle || undefined} {...rest}>
  {
    resolvedImage && (
      <div class="hero-bg">
        <Image src={resolvedImage} alt="" aspectRatio="16/9" backgroundPosition="center" />
      </div>
    )
  }
  <div class="hero-content">
    {resolvedTitle && <h2>{resolvedTitle}</h2>}
    {resolvedBody && <p set:html={resolvedBody} />}
    {
      isCta && (
        <div class="hero-cta">
          <Link variant="solid" size="lg" href={resolvedCtaHref} label={resolvedCtaLabel} />
        </div>
      )
    }
  </div>
</div>
<style>
  .hero {
    position: relative;
    width: 100%;
    height: auto;
    aspect-ratio: 16 / 9;
    min-height: 500px;
    overflow: hidden;
  }
  .hero-bg {
    z-index: -1;
    overflow: hidden;
    height: 100%;
    clip-path: url(#svgshape);
  }
  .hero-content {
    position: absolute;
    inset: 0;
    display: flex;
    gap: 1rem;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin: auto;
    padding: var(--space-4);
    background: linear-gradient(to bottom, var(--hero-gradient-start), var(--hero-gradient-end));
  }
  .hero-content h2 {
    color: var(--color-white);
    font-size: clamp(2rem, 4vw, 3rem);
    margin: 0;
    text-align: center;
  }
  .hero-content p {
    color: var(--color-white);
    font-size: clamp(1rem, 2vw, 1.5rem);
    max-width: 600px;
    text-align: center;
  }
</style>
{
  resolvedClip && (
    <svg width="0" height="0" style="position:absolute">
      <defs>
        <clipPath id="svgshape" clipPathUnits="objectBoundingBox">
          <path d={resolvedClip} />
        </clipPath>
      </defs>
    </svg>
  )
}
