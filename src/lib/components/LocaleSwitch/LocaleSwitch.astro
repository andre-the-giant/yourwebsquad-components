---
/**
 * LocaleSwitch (library component)
 *
 * i18n-agnostic: you pass locales + urls.
 *
 * Props:
 * - currentLocale: string — active locale code (e.g. "en")
 * - locales: string[] — list of locale codes to render (e.g. ["en", "fr"])
 * - urls: Record<string, string> — map locale → URL (e.g. { en: "/en/", fr: "/fr/" })
 * - labels?: Record<string, string> — display labels (default uppercases code)
 * - ariaLabel?: string — default "Language"
 * - id?: string
 * - class?: string — extra class for wrapper
 * - style?: string
 *
 * Notes: current locale renders as outline and disables href; missing urls fall back to "#".
 */
import { validateProps } from "../../utils/props.js";
import { makeStyleVars, mergeClasses } from "../../utils/style.js";
import Link from "../Link/Link.astro";

const schema = {
  id: { type: "string" },
  class: { type: "string" },
  style: { type: "string" },
  currentLocale: { type: "string" },
  locales: { type: "array" },
  urls: { type: "object" },
  labels: { type: "object" },
  ariaLabel: { type: "string" }
};

const {
  id,
  class: className,
  style,
  currentLocale,
  locales = [],
  urls,
  labels = {},
  ariaLabel = "Language"
} = validateProps(schema, Astro.props, { component: "LocaleSwitch" });

const resolvedId = id ?? "locale-switch-" + Math.random().toString(36).slice(2, 9);

const getLabel = (code) => labels[code] ?? code.toUpperCase();
const getHref = (code) => (urls?.[code] ? urls[code] : "#");
const styleVars = {
  "--locale-gap": "var(--space-2)"
};
const resolvedStyle = makeStyleVars(styleVars, style);
const resolvedClass = mergeClasses("localeSwitch", className);
---

<nav
  id={resolvedId}
  class={resolvedClass}
  aria-label={ariaLabel}
  style={resolvedStyle || undefined}
>
  <ul class="localeSwitch__list">
    {
      locales.map((code) => {
        const isCurrent = code === currentLocale;
        return (
          <li class="localeSwitch__item">
            <Link
              size="xs"
              variant="outline"
              href={!isCurrent ? getHref(code) : null}
              aria-current={isCurrent ? "page" : undefined}
              label={getLabel(code)}
              disabled={isCurrent}
            />
          </li>
        );
      })
    }
  </ul>
</nav>

<style>
  .localeSwitch__list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    align-items: center;
    gap: var(--locale-gap, var(--space-2));
  }
</style>
