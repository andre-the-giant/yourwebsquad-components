---
/*
Props:
- label?: string
- href?: string
- target?: string
- rel?: string
- variant?: "solid" | "outline" | "ghost"
- size?: "xs" | "sm" | "md" | "lg"
- type?: "button" | "submit" | "reset"
- disabled?: boolean
- id?: string
- class?: string
- style?: string
- screenreader?: string
Notes:
- rel defaults to "noreferrer" when target is "_blank".
*/
import { validateProps } from "../../utils/props.js";
import { makeStyleVars, mergeClasses } from "../../utils/style.js";

const schema = {
  id: { type: "string" },
  class: { type: "string" },
  style: { type: "string" },
  label: { type: "string" },
  href: { type: "string" },
  target: { type: "string" },
  rel: { type: "string" },
  variant: { type: "string" },
  size: { type: "string" },
  type: { type: "string" },
  disabled: { type: "boolean" },
  screenreader: { type: "string" }
};

const {
  id,
  class: className,
  style,
  label = "Button",
  href,
  target,
  rel,
  variant = "solid",
  size = "md",
  type = "button",
  disabled = false,
  screenreader,
  ...rest
} = validateProps(schema, Astro.props, { component: "Button" });

const resolvedId = id ?? "button-" + Math.random().toString(36).slice(2, 9);
const resolvedLabel = label;
const resolvedHref = href;
const resolvedTarget = target;
const resolvedRel = rel ?? (resolvedTarget === "_blank" ? "noreferrer" : undefined);
const styleVars = {};
const resolvedStyle = makeStyleVars(styleVars, style);
const resolvedClass = mergeClasses("button", `button--${variant}`, `button--${size}`, className);
---

{
  resolvedHref ? (
    <a
      id={resolvedId}
      class={resolvedClass}
      href={resolvedHref}
      target={resolvedTarget}
      rel={resolvedRel}
      aria-disabled={disabled ? "true" : undefined}
      style={resolvedStyle || undefined}
      {...rest}
    >
      <slot>{resolvedLabel}</slot>
      {screenreader && <span class="sr-only">{screenreader}</span>}
    </a>
  ) : (
    <button
      id={resolvedId}
      class={resolvedClass}
      type={type}
      disabled={disabled}
      style={resolvedStyle || undefined}
      {...rest}
    >
      <slot>{resolvedLabel}</slot>
      {screenreader && <span class="sr-only">{screenreader}</span>}
    </button>
  )
}

<style>
  .button {
    display: inline-flex;
    align-items: center;
    place-content: center;
    gap: var(--space-2);
    padding: 0.65rem 1.5rem;
    border-radius: 0;
    border: 1px solid transparent;
    font-family: var(--button-font, var(--font-body));
    font-weight: var(--weight-semibold);
    font-size: var(--size-md);
    line-height: var(--line-tight);
    text-decoration: none;
    cursor: pointer;
    transition:
      transform 120ms ease,
      box-shadow 120ms ease,
      background 120ms ease,
      color 120ms ease,
      border-color 120ms ease;
  }

  .button:focus-visible {
    outline: 2px solid var(--button-focus);
    outline-offset: 2px;
  }

  .button[aria-disabled="true"],
  .button:disabled {
    opacity: var(--button-disabled-opacity);
    cursor: not-allowed;
  }

  .button--solid {
    background: var(--button-solid-bg);
    color: var(--button-solid-fg);
    border-color: var(--button-solid-border);
    box-shadow: var(--button-solid-shadow);
  }

  .button--solid:hover {
    transform: translateY(-1px);
  }

  .button--outline {
    background: var(--button-outline-bg);
    color: var(--button-outline-fg);
    border-color: var(--button-outline-border);
  }

  .button--outline:hover {
    background: var(--button-outline-hover-bg);
    color: var(--button-outline-hover-fg);
  }

  .button--ghost {
    background: var(--button-ghost-bg);
    color: var(--button-ghost-fg);
    border-color: var(--button-ghost-border);
    text-decoration: dotted underline;
  }

  .button--ghost:hover {
    background: var(--button-ghost-hover-bg);
    color: var(--button-ghost-hover-fg);
    text-decoration: none;
  }

  .button--xs {
    padding: 0.2rem 0.5rem;
    font-size: var(--size-xs);
    font-weight: 400;
  }
  .button--sm {
    padding: 0.45rem 1rem;
    font-size: var(--size-sm);
    box-shadow: 0;
  }

  .button--md {
    padding: 0.65rem 1.5rem;
    font-size: var(--size-md);
  }

  .button--lg {
    padding: 0.85rem 1.9rem;
    font-size: var(--size-lg);
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
</style>
